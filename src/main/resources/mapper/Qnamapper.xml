<?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="bucheon.leafy.domain.qna.dao.QnaDaoImpl">

        <select id="count" resultType="int">
            SELECT count(*) FROM leafy
        </select>

        <delete id="deleteAll">
            DELETE FROM leafy
        </delete>

        <delete id="delete" parameterType="map">
            DELETE FROM leafy WHERE bno = #{bno} and id = #{id}
        </delete>

        <insert id="insert" parameterType="QnaDto">
            INSERT INTO leafy
                (title, content, id)
            VALUES
                (#{title}, #{content}, #{id})
        </insert>

        <select id="selectAll" resultType="QnaDto">
            SELECT bno, title, content, id, view_cnt, reply_cnt, reg_date
            FROM leafy
            ORDER BY reg_date DESC, bno DESC
        </select>

        <sql id="selectFromQnA">
            SELECT bno, title, content, id, view_cnt, reply_cnt, reg_date
            FROM leafy
        </sql>

        <select id="select" parameterType="int" resultType="QnaDto">
            <include refid="selectFromQnA"/>
            WHERE bno = #{bno}
        </select>

        <select id="selectPage" parameterType="map" resultType="QnaDto">
            <include refid="selectFromQnA"/>
            ORDER BY reg_date DESC, bno DESC
            LIMIT #{offset}, #{pageSize}
        </select>

        <update id="update" parameterType="QnaDto">
            UPDATE leafy
            SET   title = #{title}
              , content = #{content}
              , up_date = now()
            WHERE user_id = #{user_id}
        </update>

        <update id="updateCommentCnt" parameterType="map">
            UPDATE leafy
            SET   reply_cnt = reply_cnt + #{cnt}
            WHERE bno = #{bno}
        </update>

        <update id="increaseViewCnt" parameterType="int">
            UPDATE leafy
            SET   view_cnt = view_cnt + 1
            WHERE bno = #{bno}
        </update>
    </mapper>
